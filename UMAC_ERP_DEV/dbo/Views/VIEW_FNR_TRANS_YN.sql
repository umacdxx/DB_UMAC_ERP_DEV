
/*
-- 생성자 : 강세미
-- 등록일 :	2024.10.31
-- 설 명  : FNR배차유무 조건
-- 수정자 :
-- 수정일 :
-- 수정내용 :

*/
CREATE VIEW [dbo].[VIEW_FNR_TRANS_YN]
AS
	WITH LIST AS (
		SELECT 
			A.ORD_NO,
			CASE WHEN B.VEN_CODE IN ('UM20131', 'UM20209', 'UM20130') THEN 'N' ELSE 'Y' END AS FNR_TRANS_YN -- 거래처 케이앤, 쿠팡 제외
		  FROM PO_ORDER_HDR AS A
		   INNER JOIN CD_PARTNER_MST AS B ON A.VEN_CODE = B.VEN_CODE
		UNION ALL 
		SELECT
			A.ORD_NO,
			CASE WHEN C.VEN_CODE <> 'UM10038' AND D.SCAN_CODE IN ('120001','120003','120004','120005','120006',
					  '120007','120008','120010','120011','120012', '130002'
					  ) THEN 'Y' ELSE 'N' END AS FNR_TRANS_YN -- 거래처 케이앤 제외, 옥배아 OR 원유 OR 정제유 노출
		  FROM PO_PURCHASE_HDR AS A
		   INNER JOIN PO_PURCHASE_DTL AS B ON A.ORD_NO = B.ORD_NO
		   INNER JOIN CD_PARTNER_MST AS C ON A.VEN_CODE = C.VEN_CODE
		   INNER JOIN CD_PRODUCT_CMN AS D ON B.SCAN_CODE = D.SCAN_CODE
	 )
	 SELECT ORD_NO,
			FNR_TRANS_YN
	   FROM LIST

GO

